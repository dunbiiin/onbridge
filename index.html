<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ring + Spinning N (Glossy Metal, Low Glow)</title>
  <style>
    html,body{margin:0;height:100%;background:#000;}
    #wrap{position:relative;width:100vw;height:100vh;overflow:hidden;}
    canvas{display:block;width:100%;height:100%;}
    #debug{position:fixed;left:12px;bottom:12px;max-width:calc(100% - 24px);padding:10px 12px;background:rgba(0,0,0,.65);border:1px solid rgba(255,255,255,.18);border-radius:10px;color:#fff;font:12px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;white-space:pre-wrap;z-index:9999;display:none;}
  </style>
</head>
<body>
  <div id="wrap"></div>
  <div id="debug"></div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";
    import { FontLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/FontLoader.js";
    import { TextGeometry } from "https://unpkg.com/three@0.160.0/examples/jsm/geometries/TextGeometry.js";
    import { RoomEnvironment } from "https://unpkg.com/three@0.160.0/examples/jsm/environments/RoomEnvironment.js";

    const debugEl = document.getElementById("debug");
    const showError = (msg) => { debugEl.style.display = "block"; debugEl.textContent = msg; };

    try{
      const container = document.getElementById("wrap");

      // Renderer (색/톤매핑을 “메탈 하이라이트”에 유리하게)
      const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, powerPreference:"high-performance" });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.0;
      container.appendChild(renderer.domElement);

      // Scene / Camera
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(38, container.clientWidth / container.clientHeight, 0.1, 100);
      camera.position.set(0, 0.15, 6.2);

      // Controls (고정 연출)
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.enablePan = false;
      controls.enableZoom = false;
      controls.enableRotate = false;

      // Environment (메탈릭 반사 핵심)
      const pmrem = new THREE.PMREMGenerator(renderer);
      const envTex = pmrem.fromScene(new RoomEnvironment(renderer), 0.04).texture;
      scene.environment = envTex;

      // Lights (네온 느낌 방지: 강도 낮추고 하이라이트 중심)
      const key = new THREE.DirectionalLight(0xffffff, 2.2);
      key.position.set(4, 4.5, 5);
      scene.add(key);

      const fill = new THREE.DirectionalLight(0xffffff, 0.9);
      fill.position.set(-5, 2.0, 4);
      scene.add(fill);

      const rim = new THREE.DirectionalLight(0xffffff, 1.4);
      rim.position.set(0, -1.5, -6);
      scene.add(rim);

      scene.add(new THREE.AmbientLight(0xffffff, 0.15));

      // ===== Materials =====
      // 링: 메탈릭 실버, “보이게” roughness 너무 낮추지 않음
      const silverMetal = new THREE.MeshPhysicalMaterial({
        color: 0xD8D8D8,
        metalness: 1.0,
        roughness: 0.18,
        clearcoat: 0.55,
        clearcoatRoughness: 0.08
      });

      // N: 핫핑크 “광택” + 메탈 느낌 (발광 거의 0)
      const pinkGloss = new THREE.MeshPhysicalMaterial({
        color: 0xFD4DA6,
        metalness: 0.65,
        roughness: 0.22,
        clearcoat: 0.75,
        clearcoatRoughness: 0.10,
        emissive: new THREE.Color(0x000000),
        emissiveIntensity: 0.0
      });

      // ===== Ring (고정) =====
      const ringGeo = new THREE.TorusGeometry(2.25, 0.19, 64, 320);
      const ring = new THREE.Mesh(ringGeo, silverMetal);
      ring.rotation.x = THREE.MathUtils.degToRad(10);
      ring.rotation.y = THREE.MathUtils.degToRad(12);
      scene.add(ring);

      // 링이 배경에 묻히면 이 “얇은 라이트림”만 살짝 추가(과하면 0으로)
      const ringRim = new THREE.MeshPhysicalMaterial({
        color: 0xffffff,
        metalness: 0.0,
        roughness: 0.9,
        transparent: true,
        opacity: 0.06
      });
      const ringRimMesh = new THREE.Mesh(ringGeo, ringRim);
      ringRimMesh.scale.setScalar(1.003);
      ringRimMesh.rotation.copy(ring.rotation);
      scene.add(ringRimMesh);

      // ===== N Group (회전 대상) =====
      const nGroup = new THREE.Group();
      nGroup.position.set(0, 0, 0.10);
      nGroup.rotation.y = THREE.MathUtils.degToRad(12);
      scene.add(nGroup);

      // Font + build "N"
      const fontLoader = new FontLoader();
      fontLoader.load(
        "https://unpkg.com/three@0.160.0/examples/fonts/helvetiker_bold.typeface.json",
        (font) => {
          const textGeo = new TextGeometry("N", {
            font,
            size: 1.95,
            height: 0.38,
            curveSegments: 10,
            bevelEnabled: true,
            bevelThickness: 0.055,
            bevelSize: 0.04,
            bevelSegments: 4
          });
          textGeo.computeBoundingBox();
          textGeo.center();

          const nMesh = new THREE.Mesh(textGeo, pinkGloss);
          nMesh.position.z = 0.06;
          nGroup.add(nMesh);
        },
        undefined,
        (err) => showError("폰트 로딩 실패로 N 생성이 안 됐습니다.\n" + (err?.message || String(err)))
      );

      // Animation (N만 회전, 링 고정)
      const clock = new THREE.Clock();
      const animate = () => {
        const t = clock.getElapsedTime();

        nGroup.rotation.y = t * 0.85;
        nGroup.rotation.x = Math.sin(t * 0.7) * 0.04;

        controls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      };
      animate();

      // Resize
      const onResize = () => {
        const w = container.clientWidth;
        const h = container.clientHeight;
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
        renderer.setSize(w, h);
      };
      window.addEventListener("resize", onResize);

    }catch(e){
      showError("초기화 중 에러가 발생했습니다.\n" + (e?.stack || String(e)));
    }
  </script>
</body>
</html>
